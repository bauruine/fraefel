<div data-type="modal2" style="display:none;"></div>
<div data-type="modal" style="display:none;">
  <%= form_for @search, :url => purchase_positions_path, :html => {"data-tab" => "filter", :method => :get} do |f| %>
    <div class="floatLeft">
      <%= f.label(:delivered_equals, "Versendet?") %>
      <%= f.select(:delivered_equals, { 'Nein' => false, 'Ja' => true }, {}, {:class => "span2"}) %>
    </div>
    <div class="floatLeft">
      <%= f.label(:delivery_date_greater_than_or_equal_to, "Von") %>
      <%= f.text_field :delivery_date_greater_than_or_equal_to, :class => "date_picker span2" %>
    </div>
    <div class="floatLeft">
      <%= f.label(:delivery_date_less_than_or_equal_to, "Bis") %>
      <%= f.text_field :delivery_date_less_than_or_equal_to, :class => "date_picker span2" %>
    </div>
    <div class="clear"></div>
    <hr />
    
    <div class="floatLeft">
      <%= f.label(:priority_level_equals, "Prio Stufe") %>
      <%= f.select(:priority_level_equals, { 'TS Aktiv' => 0, 'Normal' => 1, 'Termin Verschoben' => 2 }, {:include_blank => true}, {:class => "span3"}) %>
    </div>
    <div class="floatLeft">
      <%= f.label(:picked_up_equals, "Warenentnahme abg?") %>
      <%= f.select(:picked_up_equals, { 'Nein' => false, 'Ja' => true }, {}, {:class => "span3"}) %>
    </div>
    <hr />
    <div class="floatLeft">
      <%= f.label(:purchase_order_warehousing_completed_gteq, "Einlagerung >= ?%") %>
      <%= f.select(:purchase_order_warehousing_completed_gteq, { '>= 0%' => 0.0, '>= 10%' => 10.0, '>= 20%' => 20.0, '>= 30%' => 30.0, '>= 40%' => 40.0, '>= 50%' => 50.0, '>= 60%' => 60.0, '>= 70%' => 70.0, '>= 80%' => 80.0, '>= 90%' => 90.0, '>= 100%' => 100.0 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Auftrag</small>
    </div>
    <div class="floatLeft">
      <%= f.label(:purchase_order_warehousing_completed_lteq, "Einlagerung <= ?%") %>
      <%= f.select(:purchase_order_warehousing_completed_lteq, { '<= 100%' => 100.0, '<= 99%' => 99.0, '<= 90%' => 90.0, '<= 80%' => 80.0, '<= 70%' => 70.0, '<= 60%' => 60.0, '<= 50%' => 50.0, '<= 40%' => 40.0, '<= 30%' => 30.0, '<= 20%' => 20.0, '<= 10%' => 10.0, '<= 0%' => 0.0 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Auftrag</small>
    </div>
    <div class="clear"></div>
    <hr />
    <div class="floatLeft">
      <%= f.label(:purchase_order_manufacturing_completed_gteq, "Produktion >= ?%") %>
      <%= f.select(:purchase_order_manufacturing_completed_gteq, { '>= 0%' => 0.0, '>= 10%' => 10.0, '>= 20%' => 20.0, '>= 30%' => 30.0, '>= 40%' => 40.0, '>= 50%' => 50.0, '>= 60%' => 60.0, '>= 70%' => 70.0, '>= 80%' => 80.0, '>= 90%' => 90.0, '>= 100%' => 100.0 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Auftrag</small>
    </div>
    <div class="floatLeft">
      <%= f.label(:purchase_order_manufacturing_completed_lteq, "Produktion <= ?%") %>
      <%= f.select(:purchase_order_manufacturing_completed_lteq, { '<= 100%' => 100.0, '<= 99%' => 99.0, '<= 90%' => 90.0, '<= 80%' => 80.0, '<= 70%' => 70.0, '<= 60%' => 60.0, '<= 50%' => 50.0, '<= 40%' => 40.0, '<= 30%' => 30.0, '<= 20%' => 20.0, '<= 10%' => 10.0, '<= 0%' => 0.0 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Auftrag</small>
    </div>
    <div class="clear"></div>
    <hr />
    <div class="floatLeft">
      <%= f.label(:stock_status_equals, "Einlagerung beendet?") %>
      <%= f.select(:stock_status_equals, { 'Nein' => 0, 'Ja' => 1 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Position</small>
    </div>
    <div class="floatLeft">
      <%= f.label(:production_status_equals, "Produktion beendet?") %>
      <%= f.select(:production_status_equals, { 'Nein' => 0, 'Ja' => 1 }, {:include_blank => true}, {:class => "span3"}) %>
      <small style="display: block; font-size: 10px; margin-top: 5px;">Info - Filter bezieht sich auf VK-Position</small>
    </div>
    <div class="clear"></div>
    <hr />
    <div class="floatLeft">
      <%= f.label(:purchase_order_shipping_route_id_equals, "Tour") %>
      <%= f.collection_select(:purchase_order_shipping_route_id_equals, ShippingRoute.order("name ASC"), :id, :name, {:include_blank => true}, {:class => "span2"}) %>
    </div>
    <div class="floatLeft">
      <%= f.label(:purchase_order_warehouse_number_equals, "Versandlager") %>
      <%= f.text_field(:purchase_order_warehouse_number_equals, :class => "span2") %>
    </div>
    <div class="floatLeft">
      <%= f.label(:purchase_order_category_id_equals, "VK-Art") %>
      <%= f.collection_select(:purchase_order_category_id_equals, Category.order("title ASC").where(:categorizable_type => "purchase_order"), :id, :title, {:include_blank => true}, {:class => "span2"}) %>
    </div>
    <div class="clear"></div>
    <hr />
    <div class="form-actions">
      <button type="submit" class="btn btn-primary">Filter anwenden</button>
    </div>
  <% end %>
  
  <% form_tag(search_for_purchase_positions_path, {:class => "form", "data-tab" => "goto", :method => :get}) do %>
    <ul class="ul_summary">

      <li class="summary clearfix">
        <p class="floatLeft bold title">VK-Position NR</p>
        <p class="floatLeft"><%= text_field_tag(:purchase_position_id) %></p>
      </li>
      <li class="summary clearfix">
        <p class="floatLeft title">Aktion</p>
        <p class="floatLeft"><%= submit_tag "Go", :disable_with => 'Filterning...', :name => nil %></p>
      </li>
    </ul>
  <% end %>
</div>

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft m-r_5px">Legende</h4>
  </header>
  <section class="filter_box_content clearfix">
    <div class="widgets-padder clearfix">
      <ul class="notifications">
        <li><div class="status10"><%= @purchase_positions.where(:production_status => 1, :stock_status => 0).count %><span>Produziert</span><span class="grey">&nbsp;</span></div></li>
        <li><div class="status11"><%= @purchase_positions.where(:stock_status => 1, :production_status => 1).count %><span>Produziert + Eingelagert</span><span class="grey">&nbsp;</span></div></li>
        <li><div class="status00"><%= @purchase_positions.where(:production_status => 0).count %><span>Weder noch</span><span class="grey">&nbsp;</span></div></li>
      </ul>
      <div class="clear"></div>
    </div>
  </section>
</section>
  
<div class="clearfix"></div>

<blockquote>
  <p>
    <i class="icon-asterisk"></i> VK-Pos mit aktiver Terminverschiebung
  </p>
  <p>
    <i class="icon-fire"></i> Verschobene VK-Pos
  </p>
  
</blockquote>


<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">Dispoliste</h4>
    <a data-show-tooltip="true" data-role="tab" data-warp="filter" class="header_link" href="/purchase_orders?data_role=search" title="Zeige Filter-Optionen">
      <span class="header_pack _283"></span>
    </a>
    <a href="<%= url_for(params.merge(:format => :pdf)) %>" class="header_link" data-show-tooltip="true" title="Drucke Spediliste">
      <span class="header_pack _193"></span>
    </a>
  </header>
  <section class="filter_box_content clearfix">
    <%#= link_to("Generiere PDF", pdf_reports_path(), :method => :post, :remote => true) %>
    <table class="margin_bottom_big">
      <thead>
        <tr>
          <th>Versand</th>
          <th>Tour</th>
          <th>Position</th>
          <th>Artikel</th>
          <th>stk.</th>
          <th>Bezeichnung</th>
          <th>Produktlinie</th>
          <th>Artikelgruppe</th>
          <th>Lager Ort</th>
        </tr>
      </thead>
      <tbody>
        <% @purchase_positions.each do |purchase_position| %>
          <tr class="status<%= purchase_position.production_status %><%= purchase_position.stock_status %>">
            <td><%= purchase_position.delivery_date.to_date.to_formatted_s(:swiss_date) %></td>
            <td><%= purchase_position.purchase_order.shipping_route.name %></td>
            <% if permitted_to? :edit, :purchase_positions %>
              <td>
                <% if purchase_position.priority_level == 0 %>
                  <i class="icon-asterisk"></i>
                <% elsif purchase_position.priority_level > 1 %>
                  <i class="icon-fire"></i>
                <% end %>
                <%= link_to("#{purchase_position.purchase_order.try(:baan_id)}-#{purchase_position.position}", edit_purchase_position_path(purchase_position), "data-role" => "edit_remote2") %>
              </td>
            <% else %>
              <td>
                <% if purchase_position.purchase_order.priority_level == 0 %>
                  <i class="icon-asterisk"></i>
                <% elsif purchase_position.priority_level > 1 %>
                  <i class="icon-fire"></i>
                <% end %>
                <%= "#{purchase_position.purchase_order.baan_id}-#{purchase_position.position}" %>
              </td>
            <% end %>
            <td><%= purchase_position.article_number %></td>
            <td><%= purchase_position.quantity %></td>
            <td><%= purchase_position.article %></td>
            <td><%= purchase_position.product_line %></td>
            <td><%= purchase_position.commodity_code.content %></td>
            <td><%= purchase_position.storage_location %></td>
          </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <% 8.times do %>
            <td></td>
          <% end %>
        </tr>
      </tfoot>
    </table>
  </section>
</section>

<%= subscribe_to "/pdf_reports/#{User.current.username}" %>