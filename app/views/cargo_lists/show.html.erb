<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">Versand NR#<%= @cargo_list.id %></h1>
  <%= link_to("Edit", edit_cargo_list_path(@cargo_list), :class => "floatRight no_text_decoration blue_link_button m-r_5px", "data-type" => "modal") %>
  <%= link_to("Zollpapiere", collective_invoice_cargo_list_path(:format => :pdf), :class => "floatRight no_text_decoration blue_link_button m-r_5px") %>
  <%= link_to("Lebert", print_lebert_cargo_list_path(:format => :pdf), :class => "floatRight no_text_decoration blue_link_button m-r_5px") %>
  <%= link_to("Kontrolle", controll_invoice_cargo_list_path(:format => :pdf), :class => "floatRight no_text_decoration blue_link_button m-r_5px") %>
</header>

<% if @assigned_pallets.present? %>
  
  <ul class="ul_summary">
    <li class="summary clearfix"><p class="floatLeft bold title">Versand:</p><p class="floatLeft"><%= @cargo_list.pick_up_time_earliest.to_date.to_formatted_s(:swiss_date) %></p></li>
    <li class="summary clearfix"><p class="floatLeft bold title">Empfänger:</p><p class="floatLeft"><%= @cargo_list.referee %></p></li>
    <li class="summary clearfix"><p class="floatLeft bold title">Anz. Paletten:</p><p class="floatLeft"><%= @pallets_count.to_i %></p></li>
    <li class="summary clearfix"><p class="floatLeft bold title">Mehrplatz:</p><p class="floatLeft"><%= @cargo_list.additional_space %></p></li>
  </ul>
  
  <section class="filter_box">
    <header class="filter_box_header"><h4>Angefügte Paletten</h4></header>
    <section class="filter_box_content clearfix">
      <% form_tag(remove_pallets_cargo_lists_path, {:class => "form", :method => :post}) do %>
        <%= hidden_field_tag("cargo_id", @cargo_list.id) %>
        <table>
          <thead>
            <tr>
              <th>Paletten NR</th>
              <th>Positionen</th>
              <th>Mehrplatz</th>
              <th>Tour</th>
              <th>Empfänger</th>
              <th>Auswahl</th>
            </tr>
          </thead>
          <tbody>
            <% @assigned_pallets.each do |pallet| %>
              <tr>
                <td class="align-center"><%= pallet.id %></td>
                <td class="align-center"><%= pallet.purchase_positions.count %></td>
                <td class="align-center"><%= pallet.additional_space %></td>
                <td class="align-center"><%= pallet.purchase_order.shipping_route.name %></td>
                <td class="align-center"><%= pallet.purchase_order.purchase_positions.first.consignee_full.present? ? pallet.purchase_order.purchase_positions.first.consignee_full : pallet.purchase_order.customer.company %></td>
                <td class="align-center"><%= check_box_tag "pallet_ids[]", pallet.id %></td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td class="align-center"><%= submit_tag "Entfernen", :id => "submit", :name => "submit", :class => "form_submit", :disabled => false, :disable_with => "Please wait..." %></td>
            </tr>
          </tfoot>
        </table>
      <% end %>
    </section>
  </section>
  
<% else %>
  <div id="flash_notice">Es sind noch keine Paletten zugewiesen worden.</div>
<% end %>


<% if @pallets.present? %>
  <section class="filter_box">
    <header class="filter_box_header"><h4>Verfügbare Paletten</h4></header>
    <section class="filter_box_content clearfix">
      <% form_tag(assign_pallets_cargo_lists_path, {:class => "form", :method => :post}) do %>
        <%= hidden_field_tag("cargo_id", @cargo_list.id) %>
        <table>
          <thead>
            <tr>
              <th>Paletten NR</th>
              <th>Positionen</th>
              <th>Mehrplatz</th>
              <th>Tour</th>
              <th>Empfänger</th>
              <th>Auswahl</th>
            </tr>
          </thead>
          <tbody>
            <% @pallets.each do |pallet| %>
              <tr>
                <td class="align-center"><%= pallet.id %></td>
                <td class="align-center"><%= pallet.purchase_positions.count %></td>
                <td class="align-center"><%= pallet.additional_space %></td>
                <td class="align-center"><%= pallet.purchase_order.shipping_route.name %></td>
                <td class="align-center"><%= pallet.purchase_order.purchase_positions.first.consignee_full.present? ? pallet.purchase_order.purchase_positions.first.consignee_full : pallet.purchase_order.customer.company %></td>
                <td class="align-center"><%= check_box_tag "pallet_ids[]", pallet.id %></td>
              </tr>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td class="align-center"><%= submit_tag "Hinzufügen", :id => "submit", :name => "submit", :class => "form_submit", :disabled => false, :disable_with => "Please wait..." %></td>
            </tr>
          </tfoot>
        </table>
      <% end %>
    </section>
  </section>
  
<% else %>
  <div id="flash_notice">Es wurden bereits alle Palleten bearbeitet!</div>
<% end %>
<div data-type="modal"></div>