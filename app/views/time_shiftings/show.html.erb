<div class="page-header">
    <h1 class="pull-left">Termin Verschiebung NR#<%= @time_shifting.first.id %></h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= time_shifting_path(@time_shifting.first, :format => :pdf) %>"><i class="icon-print icon-white"></i> PDF</a>
      </div>
      
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= edit_time_shifting_path(@time_shifting.first) %>"><i class="icon-pencil icon-white"></i> Edit</a>
      </div>
      <div class="btn-group">
        <a class="btn btn-warning" href="<%= edit_time_shifting_path(@time_shifting.first, :tab => "close_time_shifting") %>"><i class="icon-off icon-white"></i> Abschliessen</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<dl class="dl-horizontal">
  <dt>VK-Auftrag</dt>
  <dd><%= @purchase_order.first.baan_id %></dd>
  <dt>Abteilung:</dt>
  <dd><%= @time_shifting.first.department_time_shifting_assignments.last.department.title %></dd>
  <dt>Grund</dt>
  <dd><%= @time_shifting.first.shifting_reasons.collect(&:title) %></dd>
</dl>


<div class="page-header">
    <h1 class="pull-left">Abteilungen - Ablauf</h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= edit_time_shifting_path(@time_shifting.first, :tab => "departments") %>"><i class="icon-random icon-white"></i> Abteilung wechseln</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<section class="filter_box">
  <header class="filter_box_header">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Abteilung</th>
          <th>Erfasst von</th>
          <th>Erfasst am</th>
          <th>Zeit beansprucht</th>
        </tr>
      </thead>
      <tbody>
        <% @departments.each do |d_t_s_a| %>
        <tr>
          <td>
            <%= d_t_s_a.completed_at.present? ? "#{d_t_s_a.department.title}" : "* #{d_t_s_a.department.title}" %>
          </td>
          <td><%= d_t_s_a.creator.full_name %></td>
          <td><%= d_t_s_a.created_at.to_formatted_s(:swiss_date) %></td>
          <td><%= distance_of_time_in_words(d_t_s_a.created_at, (d_t_s_a.completed_at.present? ? d_t_s_a.completed_at : Time.now)) %></td>
        </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr><td colspan="4"><small>* Aktive Abteilung</small></td></tr>
      </tfoot>
    </table>
  </section>
</section>

<div class="page-header">
    <h1 class="pull-left">Artikel Codes</h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= edit_time_shifting_path(@time_shifting.first, :tab => "article_positions") %>"><i class="icon-plus-sign icon-white"></i> Artikel hinzufügen</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Artikel Code</th>
          <th>benötigt von</th>
          <th>Bemerkung</th>
          <th>Artikel Bestell Nr.</th>
          <th>Artikel WE</th>
          <th>Erfasser</th>
          <th>Erfast am</th>
        </tr>
      </thead>
      <tbody>
        <% if @article_positions.empty? %>
          <tr><td colspan="7">Es wurden keine Artikel Codes angefügt.</td></tr>
        <% else %>
          <% @article_positions.each do |article_position| %>
            <tr>
              <td><%= article_position.baan_id %></td>
              <td><%= ArticlePositionTimeShiftingAssignment.where(:article_position_id => article_position.id, :time_shifting_id => @time_shifting.first.id).first.purchase_positions_collection %></td>
              <td><%= ArticlePositionTimeShiftingAssignment.where(:article_position_id => article_position.id, :time_shifting_id => @time_shifting.first.id).first.comments.first.try(:content) %></td>
              <td></td>
              <td></td>
              <td><%= article_position.creator.full_name %></td>
              <td><%= article_position.created_at.to_formatted_s(:swiss_date) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </section>
</section>

<div class="page-header">
    <h1 class="pull-left">VK-Positionen</h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= edit_time_shifting_path(@time_shifting.first, :tab => "purchase_positions") %>"><i class="icon-check icon-white"></i> VK-Pos mutieren</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Artikel NR</th>
          <th>Artikel</th>
          <th>Produktlinie</th>
          <th>Menge Total</th>
          <th>Lager Ort</th>
          <th>PLZ Gebiet</th>
          <th>ursprünglicher Versand</th>
        </tr>
      </thead>
      <tbody>
        <% if @purchase_positions.empty? %>
          <tr><td colspan="8">Ups... Es wurden keine VK-Pos angefügt.</td></tr>
        <% else %>
          <% @purchase_positions.each do |purchase_position| %>
            <tr>
              <td><%= purchase_position.baan_id %></td>
              <td><%= purchase_position.article_number %></td>
              <td><%= purchase_position.article %></td>
              <td><%= purchase_position.product_line %></td>
              <td><%= purchase_position.quantity %></td>
              <td><%= purchase_position.storage_location %></td>
              <td><%= purchase_position.zip_location_name %></td>
              <td><%= purchase_position.delivery_date.to_date.to_formatted_s(:swiss_date) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </section>
</section>

<div class="page-header">
    <h1 class="pull-left">Nachrichten</h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= edit_time_shifting_path(@time_shifting.first, :tab => "comments") %>"><i class="icon-comment icon-white"></i> Nachricht hinzufügen</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix" style="padding: 10px;">

    <% @comments.each do |comment| %>
      <div style="width: 50%; margin-bottom: 30px;">
        <h3>Nachricht erstellt von <%= comment.user.full_name %> um <%= comment.created_at.to_formatted_s(:swiss_date) %></h3>
        <hr />
        <%= comment.content %>
      </div>
    <% end %>
    
  </section>
</section>