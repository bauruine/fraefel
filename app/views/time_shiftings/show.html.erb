<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">Termin Verschiebung NR#<%= @time_shifting.first.id %></h1>
  <%= link_to("PDF", time_shifting_path(@time_shifting.first, :format => :pdf), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
  <%= link_to("Abschliessen", edit_time_shifting_path(@time_shifting.first, :tab => "close_time_shifting"), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
  <%= link_to("Edit", edit_time_shifting_path(@time_shifting.first), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
</header>
<hr />

<ul class="ul_summary">
  <li class="summary clearfix"><p class="floatLeft bold title">VK-Auftrag:</p><p class="floatLeft"><%= @purchase_order.first.baan_id %></p></li>
  <li class="summary clearfix"><p class="floatLeft bold title">Abteilung:</p><p class="floatLeft"><%= @time_shifting.first.department_time_shifting_assignments.last.department.title %></p></li>
  <li class="summary clearfix"><p class="floatLeft bold title">Grund:</p><p class="floatLeft"><%= @time_shifting.first.shifting_reasons.collect(&:title) %></p></li>
  
</ul>

<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">Abteilungen - Ablauf</h1>
  <%= link_to("Wechseln", edit_time_shifting_path(@time_shifting.first, :tab => "departments"), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
</header>
<hr />

<section class="filter_box">
  <header class="filter_box_header">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Abteilung</th>
          <th>Erfasst von</th>
          <th>Erfasst am</th>
          <th>Zeit beansprucht</th>
        </tr>
      </thead>
      <tbody>
        <% @departments.each do |d_t_s_a| %>
        <tr>
          <td>
            <%= d_t_s_a.completed_at.present? ? "#{d_t_s_a.department.title}" : "* #{d_t_s_a.department.title}" %>
          </td>
          <td><%= d_t_s_a.creator.full_name %></td>
          <td><%= d_t_s_a.created_at.to_formatted_s(:swiss_date) %></td>
          <td><%= distance_of_time_in_words(d_t_s_a.created_at, (d_t_s_a.completed_at.present? ? d_t_s_a.completed_at : Time.now)) %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
  </section>
</section>

<div class="clear"></div>

<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">Artikel Codes</h1>
  <%= link_to("Hinzufügen", edit_time_shifting_path(@time_shifting.first, :tab => "article_positions"), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
</header>
<hr />

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Artikel Code</th>
          <th>benötigt von</th>
          <th>Bemerkung</th>
          <th>Artikel Bestell Nr.</th>
          <th>Artikel WE</th>
          <th>Erfasser</th>
          <th>Erfast am</th>
        </tr>
      </thead>
      <tbody>
        <% if @article_positions.empty? %>
          <tr><td colspan="7">Es wurden keine Artikel Codes angefügt.</td></tr>
        <% else %>
          <% @article_positions.each do |article_position| %>
            <tr>
              <td><%= article_position.baan_id %></td>
              <td><%= ArticlePositionTimeShiftingAssignment.where(:article_position_id => article_position.id, :time_shifting_id => @time_shifting.first.id).first.purchase_positions_collection %></td>
              <td><%= ArticlePositionTimeShiftingAssignment.where(:article_position_id => article_position.id, :time_shifting_id => @time_shifting.first.id).first.comments.first.try(:content) %></td>
              <td></td>
              <td></td>
              <td><%= article_position.creator.full_name %></td>
              <td><%= article_position.created_at.to_formatted_s(:swiss_date) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </section>
</section>

<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">VK-Positionen</h1>
  <%= link_to("Mutieren", edit_time_shifting_path(@time_shifting.first, :tab => "purchase_positions"), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
</header>
<hr />

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix">
    <table>
      <thead>
        <tr>
          <th>Position</th>
          <th>Artikel NR</th>
          <th>Artikel</th>
          <th>Produktlinie</th>
          <th>Menge Total</th>
          <th>Lager Ort</th>
          <th>PLZ Gebiet</th>
          <th>ursprünglicher Versand</th>
        </tr>
      </thead>
      <tbody>
        <% if @purchase_positions.empty? %>
          <tr><td colspan="8">Ups... Es wurden keine VK-Pos angefügt.</td></tr>
        <% else %>
          <% @purchase_positions.each do |purchase_position| %>
            <tr>
              <td><%= purchase_position.baan_id %></td>
              <td><%= purchase_position.article_number %></td>
              <td><%= purchase_position.article %></td>
              <td><%= purchase_position.product_line %></td>
              <td><%= purchase_position.quantity %></td>
              <td><%= purchase_position.storage_location %></td>
              <td><%= purchase_position.zip_location_name %></td>
              <td><%= purchase_position.delivery_date.to_date.to_formatted_s(:swiss_date) %></td>
            </tr>
          <% end %>
        <% end %>
      </tbody>
    </table>
  </section>
</section>

<header class="resource_header margin_bottom_big clearfix">
  <h1 class="floatLeft">Nachrichten</h1>
  <%= link_to("Hinzufügen", edit_time_shifting_path(@time_shifting.first, :tab => "comments"), {:class => "floatRight no_text_decoration blue_link_button m-r_5px"}) %>
</header>
<hr />

<section class="filter_box">
  <header class="filter_box_header clearfix">
    <h4 class="floatLeft">&nbsp;</h4>
  </header>
  <section class="filter_box_content clearfix" style="padding: 10px;">

    <% @comments.each do |comment| %>
      <div style="width: 50%; margin-bottom: 30px;">
        <h3>Nachricht erstellt von <%= comment.user.full_name %> um <%= comment.created_at.to_formatted_s(:swiss_date) %></h3>
        <hr />
        <%= comment.content %>
      </div>
    <% end %>
    
  </section>
</section>