<div class="modal fade" id="goto">
  <div class="modal-header">
    <h3>Paletten - Gehe zu</h3>
  </div>
  <%= form_tag(search_for_pallets_path, {:class => "form-horizontal", :style => "margin-bottom:0;", :method => :get}) do %>
    <div class="modal-body">
      <div class="control-group">
        <%= label_tag(:pallet_id, "Palette / Coli", :class => "control-label")%>
        <div class="controls">
          <%= text_field_tag(:pallet_id, nil, :class => "text_field") %>
          <p class="help-block"><strong>Info:</strong> Bitte Paletten / Coli Nr eingeben.</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <%= submit_tag "Gehe zu", :disable_with => 'Gehe zu...', :name => nil, :class => "btn btn-primary" %>
    </div>
  <% end %>
</div>

<ul class="breadcrumb">
  <li>
    <a href="/"><i class="icon-home"></i> Dashboard</a> <span class="divider">/</span>
  </li>
  <li class="active">
    <a href="/pallets"><i class="icon-folder-open"></i> Paletten</a>
  </li>
</ul>

<div class="page-header">
  <h1>Paletten / Coli</h1>
</div>

<%= link_to("Print", pallets_path(:format => :pdf), :class => "btn") %>
<%= link_to("Gehe zu", "#goto", "data-toggle" => "modal", :class => "btn") %>

<% @pallets.each do |pallet| %>
  <blockquote>
    <p>
      <% if pallet.cargo_list.present? %>
        <%= "Versand NR #{pallet.cargo_list.id}" %> |
      <% end %>
      <%= pallet.pallet_type.description == "coli" ? "Coli NR #{pallet.id}" : "Palette NR #{pallet.id}" %> <%= link_to("Edit", "#pallet_#{pallet.id}", :class => "btn btn-mini btn-info", "data-toggle" => "modal") %>
    </p>
    <% if pallet.purchase_positions.present? %>
      <p><%= pallet.purchase_positions.first.consignee_full %></p>
    <% end %>
  </blockquote>
  
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>VK-Position</th>
        <th>Artikel NR</th>
        <th>Zoll</th>
        <th>Artikel</th>
        <th>Produktlinie</th>
        <th>Menge Total</th>
        <th>Lager Ort</th>
        <th>Versand</th>
      </tr>
    </thead>
    <tbody>
      <% pallet.purchase_positions.each do |purchase_position| %>
        <tr class="<%= purchase_position.nil_or_zero? ? 'yellow' : nil %>">
          <td class="<%= purchase_position.in_mixed_pallet?(pallet.id) ? 'red' : nil %>">
            <%= link_to("#{purchase_position.try(:purchase_order).try(:baan_id)}-#{purchase_position.position}", edit_purchase_position_path(purchase_position)) %>
          </td>
          <td><%= purchase_position.article_number %></td>
          <td><%= purchase_position.commodity_code.content %></td>
          <td><%= purchase_position.article %></td>
          <td><%= purchase_position.product_line %></td>
          <td><%= purchase_position.pallet_purchase_position_assignments.where(:pallet_id => pallet.id).first.quantity %></td>
          <td><%= purchase_position.storage_location %></td>
          <td><%= purchase_position.delivery_date.to_date.to_formatted_s(:swiss_date) %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <% if pallet.purchase_positions.where("purchase_positions.zip_location_id IS NOT NULL").present? %>
          <td class="bold">PLZ Gebiet: <%= pallet.purchase_positions.where("purchase_positions.zip_location_id IS NOT NULL").first.zip_location_name %></td>
        <% else %>
          <td></td>
        <% end %>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td class="align-center"></td>
      </tr>
    </tfoot>
  </table>
  <hr />
<% end %>