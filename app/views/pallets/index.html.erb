<div class="modal hide fade" id="edit_purchase_position">
</div>

<%= render("pallets/partials/index/modal/filter") %>

<div data-type="modal" style="display:none;">
</div>

<div class="page-header">
    <h1 class="pull-left">Paletten / Coli Liste</h1>
    <div class="btn-toolbar pull-right">
      <div class="btn-group">
        <a class="btn btn-primary" href="<%= pallets_path(:format => :pdf) %>"><i class="icon-print icon-white"></i> PDF</a>
      </div>
      <div class="btn-group">
        <a data-toggle="modal" href="#filter" class="btn"><i class="icon-filter"></i> Filter</a>
      </div>
    </div>
    <div class="clear"></div>
</div>

<% @pallets.each do |pallet| %>
  <blockquote style="margin-bottom: 0;">
    <p><%= pallet.shipping_address.consignee_full %></p>
  </blockquote>
  
  <table class="table table-striped">
    <thead>
      <tr>
        <th>VK-Position</th>
        <th>Artikel NR</th>
        <th>Zoll</th>
        <th>Artikel</th>
        <th>Produktlinie</th>
        <th>Menge Total</th>
        <th>Lager Ort</th>
        <th>Versand</th>
      </tr>
    </thead>
    <tbody>
      <% pallet.pallet_purchase_position_assignments.each do |pallet_purchase_position_assignment| %>
        <% purchase_position = pallet_purchase_position_assignment.purchase_position %>
        <tr>
          <% if permitted_to? :edit, :purchase_positions %>
            <td id="column_1">
              <div class="btn-group">
                <% if purchase_position.priority_level == 0 %>
                  <span class="btn btn-mini disabled">
                    <i class="icon-asterisk"></i>
                  </span>
                <% elsif purchase_position.priority_level > 1 %>
                  <span class="btn btn-mini disabled">
                    <i class="icon-fire"></i>
                  </span>
                <% end %>
                <%= link_to(purchase_position.baan_id, edit_purchase_position_path(purchase_position, :format => :xml), "data-toggle" => "modal-remote", "data-target" => "#edit_purchase_position", :class => "btn btn-mini btn-#{purchase_position.production_status}#{purchase_position.stock_status}") %>
              </div>
            </td>
          <% else %>
            <td id="column_1">
              <% if purchase_position.purchase_order.priority_level == 0 %>
                <i class="icon-asterisk"></i>
              <% elsif purchase_position.priority_level > 1 %>
                <i class="icon-fire"></i>
              <% end %>
              <span class="label label-<%= purchase_position.production_status %><%= purchase_position.stock_status %>"><%= "#{purchase_position.purchase_order.baan_id}-#{purchase_position.position}" %></span>
            </td>
          <% end %>
          <td id="column_2"><%= purchase_position.article_number %></td>
          <td id="column_3"><%= purchase_position.commodity_code.content %></td>
          <td id="column_4"><%= purchase_position.article %></td>
          <td id="column_5"><%= purchase_position.product_line %></td>
          <td id="column_6"><%= pallet_purchase_position_assignment.quantity %></td>
          <td id="column_7"><%= purchase_position.storage_location %></td>
          <td id="column_8"><%= purchase_position.delivery_date.to_date.to_formatted_s(:swiss_date) %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <td><%= pallet.pallet_type.description %>: <strong><%= pallet.id %></strong></td>
        <td>PLZ Gebiet: <strong><%= pallet.zip_location.title %></strong></td>
        <td>
          <% if pallet.cargo_list.present? %>
            Versand: <%= link_to(pallet.cargo_list.id, pallet.cargo_list) %>
          <% end %>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td>
          <div class="btn-toolbar" style="margin: 0;">
          <div class="btn-group">
            <a href="<%= edit_pallet_path(pallet) %>" data-role="edit_remote" class="btn btn-mini">Edit</a>
            <a data-toggle="dropdown" class="btn btn-mini dropdown-toggle"><span class="caret"></span></a>
            <ul class="dropdown-menu pull-right">
              <li><a href="<%= pallet_path(pallet, :format => :pdf) %>">Drucke PDF</a></li>
            </ul>
          </div>
          </div>
        </td>
      </tr>
    </tfoot>
  </table>
<% end %>

<script type="text/javascript" charset="utf-8">
  var column_1 = 0;
  var column_2 = 0;
  var column_3 = 0;
  var column_4 = 0;
  var column_5 = 0;
  var column_6 = 0;
  var column_7 = 0;
  var column_8 = 0;
  
  $('td#column_1').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_1) {column_1 = this_width};
  });
  $('td#column_2').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_2) {column_2 = this_width};
  });
  $('td#column_3').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_3) {column_3 = this_width};
  });
  $('td#column_4').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_4) {column_4 = this_width};
  });
  $('td#column_5').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_5) {column_5 = this_width};
  });
  $('td#column_6').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_6) {column_6 = this_width};
  });
  $('td#column_7').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_7) {column_7 = this_width};
  });
  $('td#column_8').each(function(){
          var this_width = $(this).outerWidth();
          if (this_width > column_8) {column_8 = this_width};
  });
  
  $('td#column_1').css('width', column_1 + 'px');
  $('td#column_2').css('width', column_2 + 'px');
  $('td#column_3').css('width', column_3 + 'px');
  $('td#column_4').css('width', column_4 + 'px');
  $('td#column_5').css('width', column_5 + 'px');
  $('td#column_6').css('width', column_6 + 'px');
  $('td#column_7').css('width', column_7 + 'px');
  $('td#column_8').css('width', column_8 + 'px');
</script>
